        </div> <!-- /#file-list-container -->
    </div> <!-- /.container-fluid -->

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const container = document.getElementById('file-list-container');
        const breadcrumbList = document.getElementById('breadcrumb-list');
        const table = document.querySelector('table');
        
        if (!table) return;

        // Tradução e ícones baseados na extensão
        function getFileInfo(name, isDir) {
            if (isDir) return { icon: 'fa-folder icon-folder', type: 'Pasta' };
            
            const ext = name.split('.').pop().toLowerCase();
            const map = {
                'zip': { icon: 'fa-file-archive icon-archive', type: 'Arquivo Compactado' },
                '7z': { icon: 'fa-file-archive icon-archive', type: 'Arquivo Compactado' },
                'rar': { icon: 'fa-file-archive icon-archive', type: 'Arquivo Compactado' },
                'gz': { icon: 'fa-file-archive icon-archive', type: 'Arquivo Compactado' },
                'jpg': { icon: 'fa-file-image icon-image', type: 'Imagem' },
                'jpeg': { icon: 'fa-file-image icon-image', type: 'Imagem' },
                'png': { icon: 'fa-file-image icon-image', type: 'Imagem' },
                'gif': { icon: 'fa-file-image icon-image', type: 'Imagem' },
                'svg': { icon: 'fa-file-image icon-image', type: 'Imagem' },
                'mp4': { icon: 'fa-file-video icon-video', type: 'Vídeo' },
                'mkv': { icon: 'fa-file-video icon-video', type: 'Vídeo' },
                'avi': { icon: 'fa-file-video icon-video', type: 'Vídeo' },
                'mp3': { icon: 'fa-file-audio icon-audio', type: 'Áudio' },
                'wav': { icon: 'fa-file-audio icon-audio', type: 'Áudio' },
                'pdf': { icon: 'fa-file-pdf icon-pdf', type: 'Documento PDF' },
                'doc': { icon: 'fa-file-word icon-word', type: 'Documento Word' },
                'docx': { icon: 'fa-file-word icon-word', type: 'Documento Word' },
                'xls': { icon: 'fa-file-excel icon-excel', type: 'Planilha Excel' },
                'xlsx': { icon: 'fa-file-excel icon-excel', type: 'Planilha Excel' },
                'ppt': { icon: 'fa-file-powerpoint icon-powerpoint', type: 'Apresentação' },
                'pptx': { icon: 'fa-file-powerpoint icon-powerpoint', type: 'Apresentação' },
                'txt': { icon: 'fa-file-lines icon-text', type: 'Arquivo de Texto' },
                'html': { icon: 'fa-file-code icon-code', type: 'Código Web' },
                'css': { icon: 'fa-file-code icon-code', type: 'Código Web' },
                'js': { icon: 'fa-file-code icon-code', type: 'Código Web' },
                'php': { icon: 'fa-file-code icon-code', type: 'Código Web' }
            };
            return map[ext] || { icon: 'fa-file icon-default', type: 'Arquivo' };
        }

        function formatSize(sizeStr) {
            if (!sizeStr || sizeStr.trim() === '-' || sizeStr.trim() === '') return '';
            return sizeStr.trim();
        }

        // Gerar Breadcrumb
        const pathParts = window.location.pathname.split('/').filter(p => p);
        let currentPath = '/';
        breadcrumbList.innerHTML = `<li class="breadcrumb-item"><a href="/"><i class="fa-solid fa-house"></i> Início</a></li>`;
        pathParts.forEach((part, index) => {
            currentPath += part + '/';
            const isLast = index === pathParts.length - 1;
            breadcrumbList.innerHTML += `
                <li class="breadcrumb-item ${isLast ? 'active' : ''}" ${isLast ? 'aria-current="page"' : ''}>
                    ${isLast ? decodeURIComponent(part) : `<a href="${currentPath}">${decodeURIComponent(part)}</a>`}
                </li>`;
        });

        // Capturar links de ordenação da tabela original
        const headers = table.querySelectorAll('th');
        if (headers.length >= 4) {
            const links = [
                { id: 'sortName', index: 0 },
                { id: 'sortDate', index: 1 },
                { id: 'sortSize', index: 2 },
                { id: 'sortDesc', index: 3 }
            ];
            links.forEach(link => {
                const originalLink = headers[link.index]?.querySelector('a');
                if (originalLink) {
                    document.getElementById(link.id).href = originalLink.href;
                    if (window.location.search.includes(originalLink.search)) {
                        document.getElementById(link.id).classList.add('active');
                        const icon = window.location.search.includes('O=A') ? 'fa-sort-up' : 'fa-sort-down';
                        document.getElementById(link.id).innerHTML += ` <i class="fa-solid ${icon}"></i>`;
                    }
                }
            });
        }

        // Processar linhas da tabela
        const rows = table.querySelectorAll('tr');
        rows.forEach(row => {
            const cells = row.querySelectorAll('td');
            if (cells.length < 2) return; 

            const linkElem = cells[0].querySelector('a');
            if (!linkElem) return;

            const name = linkElem.innerText.trim();
            if (name === "Parent Directory" || name === "Diretório Pai") return;

            // IMPORTANTE: Capturar o href original exatamente como o Apache gerou
            const href = linkElem.getAttribute('href');
            const isDir = href.endsWith('/');
            const date = cells[1] ? cells[1].innerText.trim() : '';
            const size = cells[2] ? formatSize(cells[2].innerText) : '';
            const desc = cells[3] ? cells[3].innerText.trim() : '';
            
            const info = getFileInfo(name, isDir);

            const cardHtml = `
                <div class="col-12 col-md-6 col-lg-4 col-xl-3">
                    <a href="${href}" class="file-card">
                        <div class="file-card-body">
                            <div class="file-icon">
                                <i class="fa-solid ${info.icon}"></i>
                            </div>
                            <div class="file-info">
                                <span class="file-name" title="${name}">${name}</span>
                            </div>
                        </div>
                    </a>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', cardHtml);
        });

        // Atualizar título da página
        const pageTitle = document.querySelector('h1')?.innerText || "Arquivos";
        document.getElementById('title').querySelector('span').innerText = pageTitle.replace('Index of ', 'Pasta: ');
    });
    </script>
</body>
</html>
